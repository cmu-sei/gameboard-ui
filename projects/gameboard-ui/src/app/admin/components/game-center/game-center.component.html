<ng-container *ngIf="gameCenterCtx as ctx; else loading">
    <div class="hero-thing my-4 d-flex flex-wrap align-content-center">
        <app-game-card-image class="d-block" [game]="ctx"></app-game-card-image>
        <div class="game-info-container ml-3 pt-2">
            <h1 class="fs-20 m-0">{{ ctx.name }}</h1>

            <h2 class="fs-13 font-weight-bold text-info text-upper">
                {{ ctx.isExternal ? "External" : "Standard" }}
                {{ ctx.isPractice ? "Practice" : "Competitive" }}
                {{ ctx.isTeamGame ? "Team" : "Individual" }}
                Game
            </h2>

            <h3 class="fs-12">
                {{ ctx | gameClassificationToString }}
            </h3>

            <h4 class="fs-10" *ngIf="ctx.executionWindow.start && ctx.executionWindow.end">
                {{ ctx.executionWindow.start | friendlyDateAndTime }}
                &mdash;
                {{ ctx.executionWindow.end | friendlyDateAndTime }}
            </h4>

            <div *ngIf="ctx.isLive || ctx.isRegistrationActive" class="d-flex align-content-center mt-2">
                <div *ngIf="ctx.isRegistrationActive" class="badge badge-info text-upper mr-2 p-1">
                    Registration Available
                </div>
                <div *ngIf="ctx.isLive" class="badge badge-info text-upper p-1">Live</div>
            </div>
        </div>
    </div>

    <div class="stats-container mt-3 d-flex flex-wrap align-items-baseline justify-content-between">
        <app-big-stat *ngIf="ctx.stats.teamCountNotStarted" [value]="ctx.stats.teamCountNotStarted"
            [label]="(game?.isTeamGame ? 'Teams' : 'Players') + ' not started'"></app-big-stat>
        <app-big-stat [value]="ctx.stats.playerCountActive" label="Active players"></app-big-stat>
        <app-big-stat *ngIf="game?.isTeamGame" [value]="ctx.stats.teamCountActive" label="Active teams"></app-big-stat>
        <app-big-stat [value]="ctx.stats.playerCountTotal" label="Total players"></app-big-stat>
        <app-big-stat *ngIf="game?.isTeamGame" [value]="ctx.stats.teamCountTotal" label="Total teams"></app-big-stat>
        <app-big-stat *ngIf="ctx.stats.topScore" [value]="ctx.stats.topScore" label="Top Score"
            [subLabel]="ctx.stats.topScoreTeamName"></app-big-stat>
    </div>


    <div class="tabs-container d-block mt-5">
        <tabset>
            <tab>
                <ng-template tabHeading>
                    <fa-icon [icon]="fa.gear"></fa-icon>
                </ng-template>
                <app-game-center-settings [gameId]="ctx.id"></app-game-center-settings>
            </tab>
            <tab [heading]="'Challenges' + (ctx.challengeCount ? ' (' + ctx.challengeCount + ')' : '')">
                <app-game-mapper *ngIf="game" class="d-block mt-3" [game]="game"></app-game-mapper>
            </tab>
            <tab heading="{{ ctx.isTeamGame ? 'Teams' : 'Players' }} ({{ ctx.stats.teamCountTotal }})">
                <div class="d-flex align-content-center">
                    <app-whats-this
                        whatItIs="Game Center is still under development. Uncheck this to preview our new player list!">
                        <div class="form-check ml-2">
                            <input type="checkbox" class="mr-2" [(ngModel)]="useLegacyPlayerList"
                                id="use-legacy-player-list">
                            <label for="use-legacy-player-list">Use legacy player list</label>
                        </div>
                    </app-whats-this>
                </div>

                <app-game-center-players *ngIf="!useLegacyPlayerList" [gameId]="ctx.id"></app-game-center-players>
                <app-player-registrar *ngIf="useLegacyPlayerList" [gameId]="ctx.id"></app-player-registrar>
            </tab>
            <tab *ngIf="ctx.hasScoreboard" heading="Scoreboard">
                <app-scoreboard [gameId]="ctx.id" [suppressLiveGameBanner]="true"></app-scoreboard>
            </tab>
            <tab heading="Observe">
                <app-game-center-observe [gameId]="ctx.id"></app-game-center-observe>
            </tab>
            <tab [heading]="'Tickets' + (ctx.openTicketCount ? ' (' + ctx.openTicketCount + ')' : '')">
                <app-game-center-tickets [gameId]="ctx.id"></app-game-center-tickets>
            </tab>
        </tabset>

        <div class="router-container">
            <router-outlet></router-outlet>
        </div>
    </div>
</ng-container>

<ng-template #loading>
    <app-spinner>Loading the game...</app-spinner>
</ng-template>
