<div class="manage-manual-challenge-bonuses-component m-4" *ngIf="teamScoreData">
    <table *ngIf="hasStartedChallenges" class="table table-striped border-bottom border-info">
        <thead class="h5">
            <th scope="col" width="30%">Challenge</th>
            <th scope="col" width="10%"></th>
            <th scope="col" width="10%">Base</th>
            <th scope="col" width="15%">Auto Bonus</th>
            <th scope="col" width="15%">Manual Bonus</th>
            <th scope="col" width="15%">Total score</th>
        </thead>
        <tbody>
            <tr *ngFor="let challengeSummary of teamScoreData.score.challenges">
                <td>
                    <div class="points-breakdown">
                        <h6>{{challengeSummary.name}}</h6>

                        <ul *ngIf="challengeSummary.manualBonuses?.length" class="mt-2">
                            <li *ngFor="let manualBonus of challengeSummary.manualBonuses">
                                <div class="bonus-description">
                                    {{ manualBonus.pointValue > 0 ? "+" : "-" }} {{ manualBonus.pointValue }}
                                    for <strong>{{ manualBonus.description }}</strong>

                                    <em>
                                        ({{ manualBonus.enteredBy.name }},
                                        {{ manualBonus.enteredOn | shortdate}} @
                                        {{ manualBonus.enteredOn | friendlyTime }})
                                    </em>
                                </div>
                            </li>
                        </ul>
                    </div>
                </td>
                <td>
                    <div class="challenge-title-spacer" *ngIf="challengeSummary.manualBonuses?.length"></div>

                    <div class="delete-bonus-button-container"
                        *ngFor="let manualBonus of challengeSummary.manualBonuses">
                        <button class="btn btn-sm btn-danger" type="button"
                            (click)="handleDelete(manualBonus.id)">Delete</button>
                    </div>
                </td>
                <td>
                    <h6>{{ challengeSummary.score.completionScore }}</h6>
                </td>
                <td>
                    <h6>{{ challengeSummary.score.bonusScore }}</h6>
                </td>
                <td>
                    <h6>{{ challengeSummary.score.manualBonusScore }}</h6>
                </td>
                <td>
                    <h6>{{ challengeSummary.score.totalScore }}</h6>
                </td>
            </tr>

            <tr class="table-info h6">
                <td></td>
                <td></td>
                <td>{{teamScoreData.score.overallScore.completionScore}}</td>
                <td>{{teamScoreData.score.overallScore.bonusScore}}</td>
                <td>{{teamScoreData.score.overallScore.manualBonusScore}}</td>
                <td>{{teamScoreData.score.overallScore.totalScore}}</td>
            </tr>
        </tbody>
    </table>

    <ng-template #noBonuses>
        <div class="text-secondary">
            {{teamScoreData.score.team.name}} hasn't been awarded any bonuses for this game. To give them one, use the
            form below.
        </div>
    </ng-template>

    <div class="add-bonus-container mt-5">
        <h3 class="mt-3 mb-2">Add a bonus</h3>
        <form #newBonusForm (submit)="onSubmit()" *ngIf="hasStartedChallenges">
            <div class="form-group w-100">
                <select class="form-control form-control-lg w-100" name="challengeId"
                    aria-label="Select challenge for bonus" [(ngModel)]="newChallengeBonusModel.challengeId" required>
                    <option *ngFor="let challenge of teamScoreData.score.challenges" [value]="challenge.id">
                        {{ challenge.name }}
                    </option>
                </select>
            </div>
            <div class="form-group">
                <label for="bonusDescription">Bonus description</label>
                <input type="text" class="form-control" id="bonusDescription" name="bonusDescription"
                    placeholder="Description for this bonus" required [(ngModel)]="newChallengeBonusModel.description">
            </div>
            <div class="form-group">
                <label for="bonusValue">Points</label>
                <input type="number" class="form-control" id="bonusValue" name="pointValue"
                    placeholder="Points to award" min="1" [(ngModel)]="newChallengeBonusModel.pointValue">
            </div>
            <button type="submit" class="btn btn-primary"
                [disabled]="!newChallengeBonusModel.challengeId || !newChallengeBonusModel.description || !newChallengeBonusModel.pointValue">
                Add this bonus
            </button>
        </form>

        <ng-template #noChallengesStarted>
            <div class="no-challenges-started-message">
                Bonuses can only be added after a challenge has begun, and this player/team hasn't started any yet.
            </div>
        </ng-template>
    </div>
</div>
