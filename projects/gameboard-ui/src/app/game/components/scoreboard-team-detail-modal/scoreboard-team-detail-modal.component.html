<ng-container *ngIf="context">
    <div class="modal-header">
        <div class="modal-title pull-left d-flex align-items-center">
            <div *ngIf="!isTeam" class="single-player-avatar">
                <app-player-avatar size="medium" [player]="context.teamData.players[0]"></app-player-avatar>
            </div>
            <div class="headers ml-3 pt-3">
                <h3>
                    <span class="subtle-text">
                        {{ isTeam ? "Team" : "Player" }} Score:
                    </span>
                    {{ context.game.name }}
                </h3>
                <h2>{{context.teamData.team.name}}</h2>
            </div>
        </div>
        <button type="button" class="btn-close close pull-right" aria-label="Close" (click)="handleModalClose()">
            <span aria-hidden="true" class="visually-hidden">&times;</span>
        </button>
    </div>
    <div class="modal-body container">
        <div *ngIf="isTeam" class="team-detail-section">
            <div class="player-list">
                <ul class="d-flex align-items-center justify-content-center">
                    <li *ngFor="let player of context.teamData.players">
                        <div class="player-detail-container text-center mx-3">
                            <app-player-avatar [player]="player" size="large"></app-player-avatar>
                            <div class="player-name">{{ player.name }}</div>
                            <div class="sponsor-name">{{ player.sponsor.name }}</div>
                        </div>
                    </li>
                </ul>
            </div>
        </div>

        <div class="team-detail-section">
            <h4>Score</h4>

            <div class="score-breakdown d-flex align-items-center justify-content-center my-4">
                <div class="score-component">
                    <div class="score-value">{{ context.teamData.overallScore.completionScore }}</div>
                    <div class="score-label">Challenge Points</div>
                </div>

                <ng-container *ngIf="hasBonuses">
                    <div class="score-plus">+</div>
                    <div class="score-component">
                        <div class="score-value">{{ context.teamData.overallScore.bonusScore }}</div>
                        <div class="score-label">Bonus Points</div>
                    </div>
                </ng-container>

                <ng-container *ngIf="hasManualChallengeBonuses || hasManualTeamBonuses">
                    <div class="score-plus">+</div>
                    <div class="score-component">
                        <div class="score-value">{{ context.teamData.overallScore.manualBonusScore }}</div>
                        <div class="score-label">Admin Adjustment</div>
                    </div>
                </ng-container>

                <ng-container *ngIf="hasBonuses || hasManualChallengeBonuses || hasManualTeamBonuses">
                    <div class="score-equals">=</div>
                    <div class="score-value score-total text-info">
                        {{ context.teamData.overallScore.totalScore }}
                    </div>
                </ng-container>
            </div>
        </div>

        <div class="team-detail-section">
            <h4>Challenges</h4>

            <table class="challenge-results-table table table-striped gameboard-table w-100 mt-3">
                <col>
                <col>
                <col *ngIf="hasBonuses">
                <col *ngIf="hasManualChallengeBonuses">
                <col>

                <thead class="thead-light">
                    <tr class="headers">
                        <th scope="col">Challenge</th>
                        <th scope="col" class="numeric-column">Points</th>
                        <th scope="col" *ngIf="hasBonuses" class="numeric-column">Bonus</th>
                        <th scope="col" *ngIf="hasManualChallengeBonuses" class="numeric-column">Adjustment</th>
                        <th scope="col" class="numeric-column  total-column">Score</th>
                    </tr>
                </thead>

                <tbody>
                    <tr *ngFor="let challenge of context.teamData.challenges">
                        <td>
                            {{challenge.name}}
                            <div [class]="challenge.result | challengeResultColor">
                                <strong>{{ challenge.result | challengeResultPretty }}</strong>
                            </div>
                        </td>
                        <td class="numeric-column">
                            {{ challenge.score.completionScore }}
                        </td>
                        <td *ngIf="hasBonuses" class="numeric-column">
                            <span> {{ challenge.score.bonusScore }}</span>
                        </td>
                        <td *ngIf="hasManualChallengeBonuses" class="numeric-column">
                            {{ challenge.score.manualBonusScore }}
                        </td>
                        <td class="numeric-column total-column">
                            {{ challenge.score.totalScore }}
                        </td>
                    </tr>
                </tbody>

                <tfoot>
                    <td></td>
                    <td class="numeric-column"> {{ context.teamData.overallScore.completionScore }}</td>
                    <td *ngIf="hasBonuses" class="numeric-column">
                        {{ context.teamData.overallScore.bonusScore }}
                    </td>
                    <td *ngIf="hasManualChallengeBonuses" class="numeric-column">
                        {{ challengeManualBonusTotal }}
                    </td>
                    <td class="numeric-column  total-column">
                        <!--team level bonuses get displayed in a separate table below-->
                        {{ context.teamData.overallScore.totalScore - teamManualBonusTotal }}
                    </td>
                </tfoot>
            </table>
        </div>

        <div class="team-detail-section" *ngIf="context.teamData.manualBonuses.length">
            <h4>Additional Bonuses</h4>

            <table class="table table-striped gameboard-table w-100 mt-3">
                <col>
                <col>

                <thead class="thead-light">
                    <tr class="headers">
                        <th>Bonus</th>
                        <th class="numeric-column total-column">Score</th>
                    </tr>
                </thead>

                <tbody>
                    <tr *ngFor="let bonus of context.teamData.manualBonuses">
                        <td>
                            {{bonus.description}}
                        </td>
                        <td class="numeric-column">
                            {{bonus.pointValue}}
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="team-detail-section">
            <div class="d-flex grand-total-container">
                <div class="flex-grow-1">Grand Total</div>
                <div class="total-column text-center">{{context.teamData.overallScore.totalScore}}</div>
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-info" (click)="handleModalClose()">OK</button>
    </div>
</ng-container>

<ng-template #scoreBreakdownNoBonuses>
    <div>{{ context.teamData.overallScore.totalScore }}</div>
</ng-template>

<ng-template #scoreBreakdownWithBonuses>

</ng-template>
