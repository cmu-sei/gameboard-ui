<div class="players-report-component" *ngIf="ctx; else loading">
    <div class="report-parameters">
        <app-report-parameters-container>
            <app-parameter-series name="series" ngDefaultControl
                [(ngModel)]="ctx.selectedParameters.series"></app-parameter-series>
            <app-parameter-track name="track" ngDefaultControl
                [(ngModel)]="ctx.selectedParameters.track"></app-parameter-track>
            <app-parameter-game-challengespec ngDefaultControl
                [(ngModel)]="ctx.selectedParameters.gameChallengeSpec"></app-parameter-game-challengespec>
            <app-parameter-sponsor ngDefaultControl
                [(ngModel)]="ctx.selectedParameters.sponsorId"></app-parameter-sponsor>
        </app-report-parameters-container>
        <hr />
    </div>

    <div class="report-body mt-4" *ngIf="ctx.results.records.length" #playersReport>
        <table class="report-table table-hover gameboard-report">
            <col>
            <col>
            <col>
            <colgroup span="4"></colgroup>
            <colgroup span="4"></colgroup>

            <thead class="thead-light">
                <tr class="headers super-headers-row">
                    <th scope="col"></th>
                    <th scope="col"></th>
                    <th scope="col"></th>
                    <th scope="col" colSpan="4" class="group-header">Games</th>
                    <th scope="col" colspan="4" class="group-header">Challenges</th>
                </tr>
            </thead>

            <tbody>
                <tr class="headers headers-row">
                    <td>Player</td>
                    <td>Competitions</td>
                    <td>Tracks</td>
                    <td>Enrolled</td>
                    <td>Deployed</td>
                    <td>Scored Partial</td>
                    <td>Scored Complete</td>
                    <td>Enrolled</td>
                    <td>Deployed</td>
                    <td>Scored Partial</td>
                    <td>Scored Complete</td>
                </tr>

                <tr class="data-row" *ngFor="let record of ctx.results.records">
                    <td>{{record.user.name}}</td>
                    <td class="count">
                        <span
                            (click)="handleModalRequest(record.user.name + ' - Series Played', record.competitionsPlayed, 'series')"
                            [ngClass]="record.competitionsPlayed | arrayFieldToClass">
                            {{record.competitionsPlayed.length}}
                        </span>
                    </td>
                    <td class="count">
                        <span
                            (click)="handleModalRequest(record.user.name + ' - Tracks Played', record.tracksPlayed, 'track')"
                            [ngClass]="record.tracksPlayed | arrayFieldToClass">
                            {{record.tracksPlayed.length}}
                        </span>
                    </td>
                    <td class="count">
                        <span
                            (click)="handleModalRequest(record.user.name + ' - Games Enrolled', simpleEntitiesToStrings(record.games.enrolled))"
                            [ngClass]="record.games.enrolled | arrayFieldToClass">
                            {{record.games.enrolled.length}}
                        </span>
                    </td>
                    <td class="count">{{record.games.deployed.length}}</td>
                    <td class="count">{{record.games.scoredPartial.length}}</td>
                    <td class="count">{{record.games.scoredComplete.length}}</td>
                    <td class="count">{{record.challenges.enrolled.length}}</td>
                    <td class="count">{{record.challenges.deployed.length}}</td>
                    <td class="count">{{record.challenges.scoredPartial.length}}</td>
                    <td class="count">{{record.challenges.scoredComplete.length}}</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<ng-template #loading><app-spinner></app-spinner></ng-template>
